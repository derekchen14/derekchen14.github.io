<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Training on Big Data with GPUs in AWS for Deep Learning</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="../assets/built/screen.css%3Fv=245ecc38c2.css" />

    <meta name="description" content="How to guide for Deep Learning using Amazon Web Services.  A single machine with a high-powered GPU often beats  distributed computing with MapReduce when the" />
    <link rel="canonical" href="index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="amp/index.html" />
    
    <meta property="og:site_name" content="More Than One Turn" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Training on Big Data with GPUs in AWS for Deep Learning" />
    <meta property="og:description" content="How to guide for Deep Learning using Amazon Web Services.  A single machine with a high-powered GPU often beats  distributed computing with MapReduce when the" />
    <meta property="og:url" content="http://localhost:2368/training-on-big-data/" />
    <meta property="article:published_time" content="2016-01-11T04:16:29.000Z" />
    <meta property="article:modified_time" content="2016-01-14T01:47:42.000Z" />
    <meta property="article:tag" content="gpu" />
    <meta property="article:tag" content="aws" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Training on Big Data with GPUs in AWS for Deep Learning" />
    <meta name="twitter:description" content="How to guide for Deep Learning using Amazon Web Services.  A single machine with a high-powered GPU often beats  distributed computing with MapReduce when the" />
    <meta name="twitter:url" content="http://localhost:2368/training-on-big-data/" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Derek Chen" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="gpu, aws" />
    <meta name="twitter:site" content="@derekchen14" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "More Than One Turn",
        "url": "http://localhost:2368/",
        "logo": {
            "@type": "ImageObject",
            "url": "http://localhost:2368/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Derek Chen",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/9f3ee838eeb42849d4880676cedd85d6?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "http://localhost:2368/author/derek/",
        "sameAs": []
    },
    "headline": "Training on Big Data with GPUs in AWS for Deep Learning",
    "url": "http://localhost:2368/training-on-big-data/",
    "datePublished": "2016-01-11T04:16:29.000Z",
    "dateModified": "2016-01-14T01:47:42.000Z",
    "keywords": "gpu, aws",
    "description": "Recent advances in Deep Learning have come about for a couple of key reasons,\nnot the least of which is the enormous growth of available data. But if\noverwhelming amounts of data are required to reach peak performance, how does\none actually go about managing the unmanageable? In other words, how does one\nget past the hype of Big Data in machine learning and into the practical\nimplementation of leveraging Big Data for meaningful results?\n\nWhat Are My Options?\n\nIt turns out that quite often distri",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:2368/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.29" />
    <link rel="alternate" type="application/rss+xml" title="More Than One Turn" href="../rss/index.html" />
    <style>
.page-title,
.page-description {
   color:#3D0F90!important;
   text-shadow: #F7FAEB 0px 0px 0.3em;
}
a { color: #3399ff; }  
.nav li a:after { display: none; }
.nav li:before { display: none; }
li { margin: 0.2em 0; }
ol, ul {
	margin: 0;
    position: relative;
}
ol > li, ul > li { bottom: 0; }
p { margin: 0 0 0.7em 0; }
.main-header { height: 90vh; }

article.post { width: 100%; }
section.post-full-content {
    padding: 0;
    line-height: 1em;
    font-size: 1.4em;
}
h1.site-title, h2.site-description { 
    text-shadow: 2px 2px 3px #232522;
} 
    
</style>

</head>
<body class="post-template tag-gpu tag-aws">

    <div class="site-wrapper">

        

<header class="site-header">
    <div class="outer site-nav-main">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left-wrapper">
        <div class="site-nav-left">
                <a class="site-nav-logo" href="../index.html">More Than One Turn</a>
            <div class="site-nav-content">
                    <ul class="nav">
    <li class="nav-home"><a href="../index.html">Home</a></li>
    <li class="nav-about"><a href="http://feature.engineering/about">About</a></li>
    <li class="nav-contact"><a href="http://feature.engineering/contact">Contact</a></li>
</ul>

                    <span class="nav-post-title dash">Deep Learning using GPUs in the Cloud</span>
            </div>
        </div>
    </div>
    <div class="site-nav-right">
            <div class="social-links">
                    <a class="social-link social-link-tw" href="https://twitter.com/derekchen14" title="Twitter" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
            </div>
                <a class="rss-button" href="https://feedly.com/i/subscription/feed/http://localhost:2368/rss/" title="RSS" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg>
</a>

    </div>
</nav>
    </div>
</div></header>


<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post tag-gpu tag-aws no-image no-image">

            <header class="post-full-header">

                <section class="post-full-tags">
                    <a href="../tag/gpu/index.html">gpu</a>
                </section>

                <h1 class="post-full-title">Deep Learning using GPUs in the Cloud</h1>


                <div class="post-full-byline">

                    <section class="post-full-byline-content">

                        <ul class="author-list">
                            <li class="author-list-item">

                                <div class="author-card">
                                    <img class="author-profile-image" src="http://www.gravatar.com/avatar/9f3ee838eeb42849d4880676cedd85d6?s=250&amp;d=mm&amp;r=x" alt="Derek Chen" />
                                    <div class="author-info">
                                        <h2>Derek Chen</h2>
                                        <p>Read <a href="../author/derek/index.html">more posts</a> by this author.</p>
                                    </div>
                                </div>

                                <a href="../author/derek/index.html" class="author-avatar">
                                    <img class="author-profile-image" src="http://www.gravatar.com/avatar/9f3ee838eeb42849d4880676cedd85d6?s=250&amp;d=mm&amp;r=x" alt="Derek Chen" />
                                </a>

                            </li>
                        </ul>

                        <section class="post-full-byline-meta">
                            <h4 class="author-name"><a href="../author/derek/index.html">Derek Chen</a></h4>
                            <div class="byline-meta-content">
                                <time class="byline-meta-date" datetime="2016-01-11">11 Jan 2016</time>
                                <span class="byline-reading-time"><span class="bull">&bull;</span> 6 min read</span>
                            </div>
                        </section>

                    </section>


                </div>
            </header>


            <section class="post-full-content">
                <div class="post-content">
                    <!--kg-card-begin: markdown--><p>Recent advances in Deep Learning have come about for a couple of key reasons, not the least of which is the enormous growth of available data.  But if overwhelming amounts of data are required to reach peak performance, how does one actually go about managing the unmanageable?  In other words, how does one get past the hype of Big Data in machine learning and into the practical implementation of leveraging Big Data for meaningful results?</p>
<p><strong>What Are My Options?</strong></p>
<p>It turns out that quite often distributed cloud computing with Apache Hadoop, Spark, or Storm is neither the most efficient nor the most effective method of training machine learning algorithms when dealing with massive datasets.  <a href="http://localhost:2368/training-on-big-data/fastml.com/the-emperors-new-clothes-distributed-machine-learning/">Other articles</a> will dig into the details, but the gist is the overhead necessary to manage a complicated MapReduce architecture usually outweighs the benefits gained by being able to scale indefinitely with commodity hardware.  Simply put, if you're still debating whether you qualify as a Big Data company, then you don't have enough data yet, and using a single high-powered machine is your best bet.</p>
<p>After coming to the conclusion that all you need is a couple of multi-core GPUs, there are two routes: buy or rent.  The former option means <a href="https://www.reddit.com/r/MachineLearning/comments/3wk6wl/tips_on_buyingbuilding_a_computer_with_a_gpu_for/">building a custom computer</a> with powerful specs, and is largely a decision of how much you are willing to spend on a graphics card.  If you truly want a personalized machine, then this is the way to go.  However, for most practical purposes, renting a GPU through AWS is preferable because not only will it cost less in the short term, but you can also scale up in power and in the number of servers if the need arises.  Therefore, the remainder of this article will deal with how to setup and configure a GPU instance on Amazon Web Services.</p>
<p><strong>Setting Up GPUs on AWS</strong></p>
<p>If you have worked with EC2 before on AWS, then running deep learning models on GPUs will be a breeze because the process is almost identical to running programs on CPUs.  And if you have not done that before, don't worry, because Amazon has made the new user experience relatively painless as well.  Once you've created an account, the key steps are:</p>
<ul>
<li>A. Launch an EC2 Instance <img src="http://localhost:2368/content/images/2016/01/EC2_Management_Console.png" alt="Management Console"></li>
<li>B. Walk through the steps outlined in the top row:
<ol>
<li><em>Select an AMI</em> - Choose a community AMI with what you want pre-installed.  For the time being (Jan 2016), I am hosting a preconfigured set-up that comes with most of the libraries you hopefully need for Deep Learning. In particular, <code>Keras for Deep Learning (ami-5ea7d23e)</code> comes with Theano, TensorFlow, Keras and CUDA7 pre-installed.  If you truly want to go through the pain of setting everything up yourself, choose <code>64-bit Ubuntu 14.04 LTS (ami-3d50120d)</code> from the Quick Start list and follow the directions <a href="http://markus.com/install-theano-on-aws/">found here</a>. <img src="http://localhost:2368/content/images/2016/01/EC2_Step1.png" alt="AWS AMI Setup"></li>
<li><em>Choose an instance type</em> - Select &quot;GPU Instances&quot; from the &quot;All Instance Types&quot; dropdown, and pick <code>g2.2xlarge</code> from the list.  That's it!  You have just gone from CPU-computing to GPU-computing! <img src="http://localhost:2368/content/images/2016/01/EC2_Step2.png" alt="AWS_Instance"></li>
<li><em>Configure instance</em> - Choose spot instances if desired, will save a couple of dollars for every full day you plan on keeping your instance running. <img src="http://localhost:2368/content/images/2016/01/EC2_Step3.png" alt="AWS Spot"></li>
<li><em>Add storage</em> - add more EBS (Elastic Block Store) storage if so desired.  If your data set is larger than 32 GB, then you might need to explore this option, otherwise feel free to leave as is.</li>
<li><em>Tag instance</em> - add some tags to help identify this instance.  Unless you already have many instance running, in most cases, you can leave this section blank.</li>
<li><em>Configure security group</em> - <mark>Important!</mark> This section outlines who will be able to access your instance.  By default, allowing SSH with a TCP protocol coming from your own IP will allow you to connect into the terminal of your instance and perform secure copies.  If you're working from multiple locations, then add some more IPs.  If you're using other tools, then add more ports. For example, using a Rails server usually uses port 3000 and iPython Notebooks default to using port 8888. <img src="http://localhost:2368/content/images/2016/01/EC2_Step6.png" alt="Security Group"></li>
<li><em>Review</em> - Check all your details and then click [Launch]</li>
</ol>
</li>
<li>C. Save your PEM
<ol>
<li>The next dialog box will prompt you to create your security key</li>
<li>Once that is done, download your PEM in a secure and accessible location since you will need it each time to access your instance</li>
<li>Modify the access to the PEM to make it private with chmod 0400.</li>
</ol>
</li>
<li>D. Access your machine
<ol>
<li>Use  <code>ssh -i &lt;pem_file_name&gt;.pem &lt;username&gt;@&lt;your instance full dns address&gt;</code> to get in, with username usually being Ubuntu, ec2-user, or root.  The pem_ file_name is the name of the file you created in Step C2</li>
<li>A completed example might look like <code>ssh -i EC2_GPU_22x.pem ubuntu@ec2-52-29-214-135.us-west-1.compute.amazonaws.com</code></li>
<li>Use <code>scp -r -i &lt;pem_file_name&gt;.pem setup/ &lt;username&gt;@&lt;full dns address&gt;:~</code> to copy a folder into your instance.  In this case &quot;setup&quot; is the name of your folder. This command is performed from your local machine.  A similar command can be performed on your remote to <a href="http://stackoverflow.com/questions/11304895/how-to-scp-a-folder-from-remote-to-local">download files</a> into your local computer.</li>
</ol>
</li>
</ul>
<p><strong>Common Pitfalls</strong></p>
<p>If you're following this tutorial or others you've found online, you might still encounter some issues.  This is where I hope to add to the discussion to prevent hours of headache and searching through StackOverflow.  Some common issues include:</p>
<ol>
<li>You forgot to add a credit card to AWS or your credit card is expired.  Also, if your bank has recently issued you a new card because they were breached again, you will also need to update your credentials.</li>
<li>You didn't remember the password for your remote so you weren't able to use <code>sudo</code>. Now I know you didn't even try to enter the command, because on a remote machine, you don't need the password :)</li>
<li>You skipped Step C3 which limits the access to your PEM file. This will result in an error complaining about &quot;Unprotected Private Key File: Permissions 0777 for '.ssh/my_ private_key.pem' are too open.  It is required that your private key files are NOT accessible by others. This private key will be ignored.&quot; To fix the error, execute the following command, substituting the path for your private key file: <code>$ chmod 0400 .ssh/my_private_key.pem</code>.</li>
<li>You used the wrong host key, resulting in &quot;Error: Host key not found, Permission denied (publickey), or Authentication failed, permission denied&quot;.  To fix this, replace the <username> portion with <code>Ubuntu</code>.  If that doesn't work, try <code>ec2-user</code>.  If that doesn't work, try <code>root</code>.  If that doesn't work, start googling.</li>
<li>You moved out of your home and into a coffeeshop, but then you forgot to add the IP of the coffeeshop to your list of allowed IPs in &quot;Configure Security Groups&quot; in Step B6. To fix this, find &quot;Network &amp; Security&quot; on the left panel.  Then select Security Groups &gt; check the box &gt; Actions &gt; Edit Inbound Rules &gt; add your IP &gt; Save</li>
<li>You didn't upgrade your packages and now the system is complaining.  Even when you choose an existing public AMI from the community, their setup might be out of date.  It is up to you to run system updates with <code>sudo apt-get -y dist-upgrade</code> and library updates with <code>sudo pip install --upgrade &lt;package name&gt;</code></li>
<li>Anything else you see on this list: <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/TroubleshootingInstancesConnecting.html">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/TroubleshootingInstancesConnecting.html</a></li>
</ol>
<p><strong>Saving your Image</strong></p>
<p>If you added more packages or did some more set-up, you might want to save your own AMI for future use.  This will cost you a couple dollars a year, but it's a great idea if you plan to use the same configuration for multiple projects or if you're using the company budget to fund the project.   To do this, you simple go to Images on the left-hand panel and then select AMIs &gt; check the box &gt; Actions &gt; Save Image.  If you are doing other configuration work, keep in mind that you likely have an EBS-backed image and not an Instance Store-back image. <img src="http://localhost:2368/content/images/2016/01/EC2_Image.png" alt="AWS Image"><br>
And with that you're done! You now have a custom machine built for specifically for your machine learning purposes that you can use at any time.  Leave any questions or comments in the section below!</p>
<!--kg-card-end: markdown-->
                </div>
            </section>



        </article>

    </div>
</main>

<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
                <article class="read-next-card">
                    <header class="read-next-card-header">
                        <h3><span>More in</span> <a href="../tag/gpu/index.html">gpu</a></h3>
                    </header>
                    <div class="read-next-card-content">
                        <ul>
                            <li>
                                <h4><a href="../memory-error-when-training-keras-in-aws-gpus/index.html">Memory Error when Training in AWS GPUs</a></h4>
                                <div class="read-next-card-meta">
                                    <p><time datetime="2016-03-07">7 Mar 2016</time> –
                                        4 min read</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <footer class="read-next-card-footer">
                        <a href="../tag/gpu/index.html">1 post
                            →</a>
                    </footer>
                </article>

                <article class="post-card post no-image no-image">


    <div class="post-card-content">

        <a class="post-card-content-link" href="../when-you-just-a-beginner-and-already-at-the-top-of-the-leaderboards/index.html">

            <header class="post-card-header">
                <h2 class="post-card-title">When you just a beginner and already at the top of the leaderboards</h2>
            </header>

            <section class="post-card-excerpt">
                    <p>A couple of days ago, I found out that I had achieved partial Internet fame! Unfortunately, it was for a negative reason due to a simple misunderstanding.  A random person took a screenshot of a Twitter exchange I had with the founder of Keras,</p>
            </section>

        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
            
                    <div class="author-name-tooltip">
                        Derek Chen
                    </div>
            
                    <a href="../author/derek/index.html" class="static-avatar">
                        <img class="author-profile-image" src="http://www.gravatar.com/avatar/9f3ee838eeb42849d4880676cedd85d6?s=250&amp;d=mm&amp;r=x" alt="Derek Chen" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../author/derek/index.html">Derek Chen</a></span>
                <span class="post-card-byline-date"><time datetime="2016-01-31">31 Jan 2016</time> <span class="bull">&bull;</span> 2 min read</span>
            </div>
        </footer>

    </div>

</article>

                <article class="post-card post no-image no-image">


    <div class="post-card-content">

        <a class="post-card-content-link" href="../getting-started-with-machine-learning-in-python/index.html">

            <header class="post-card-header">
                <h2 class="post-card-title">Getting Started with Machine Learning in Python</h2>
            </header>

            <section class="post-card-excerpt">
                    <p>Recently, you've read numerous HN articles telling you machine learning is the future. You've heard that Google uses it for search, Facebook uses it to detect faces, and Netflix uses it for recommendations.  Your interest is sufficiently piqued.  But you might still be left</p>
            </section>

        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
            
                    <div class="author-name-tooltip">
                        Derek Chen
                    </div>
            
                    <a href="../author/derek/index.html" class="static-avatar">
                        <img class="author-profile-image" src="http://www.gravatar.com/avatar/9f3ee838eeb42849d4880676cedd85d6?s=250&amp;d=mm&amp;r=x" alt="Derek Chen" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../author/derek/index.html">Derek Chen</a></span>
                <span class="post-card-byline-date"><time datetime="2015-12-26">26 Dec 2015</time> <span class="bull">&bull;</span> 5 min read</span>
            </div>
        </footer>

    </div>

</article>
        </div>
    </div>
</aside>




        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="../index.html">More Than One Turn</a> &copy; 2020</section>
                <nav class="site-footer-nav">
                    <a href="../index.html">Latest Posts</a>
                    
                    <a href="https://twitter.com/derekchen14" target="_blank" rel="noopener">Twitter</a>
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>


    <script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous">
    </script>
    <script src="../assets/built/casper.js%3Fv=245ecc38c2"></script>

    <script>
        // Parse the URL parameter
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        // Give the parameter a variable name
        var action = getParameterByName('action');

        $(document).ready(function () {
            if (action == 'subscribe') {
                $('body').addClass("subscribe-success");
            }

            $('.subscribe-success-message .subscribe-close').click(function () {
                $('.subscribe-success-message').addClass('close');
            });

            // Reset form on opening subscrion overlay
            $('.subscribe-button').click(function() {
                $('.subscribe-overlay form').removeClass();
                $('.subscribe-email').val('');
            });
        });
    </script>

    <script>
    $(document).ready(function () {
        // FitVids - start
        var $postContent = $(".post-full-content");
        $postContent.fitVids();
        // FitVids - end

        // Replace nav with title on scroll - start
        Casper.stickyNavTitle({
            navSelector: '.site-nav-main',
            titleSelector: '.post-full-title',
            activeClass: 'nav-post-title-active'
        });
        // Replace nav with title on scroll - end

        // Hover on avatar
        var hoverTimeout;
        $('.author-list-item').hover(function () {
            var $this = $(this);

            clearTimeout(hoverTimeout);

            $('.author-card').removeClass('hovered');
            $(this).children('.author-card').addClass('hovered');

        }, function () {
            var $this = $(this);

            hoverTimeout = setTimeout(function () {
                $this.children('.author-card').removeClass('hovered');
            }, 800);
        });
    });
</script>


    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</body>
</html>
